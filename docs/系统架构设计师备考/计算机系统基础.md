# 计算机系统基础

25年改版之后，大概在5-7分
![[Pasted image 20260105173248.png]]

# 计算机系统组成

冯 诺依曼结构

![[Pasted image 20260106094807.png]]

  

哈佛结构

区别在于：存储器有没有分类（数据存储器、指令存储器）

  

PC机基本都是冯诺依曼结构

涉及到嵌入式，说到DSP，是典型的哈佛结构

  

输入输出设备：鼠标键盘是输入，显示器是输出

  

---

  

总线结构：数据总线，地址总线；

所以对于哈佛结构，就有四条总线（概念上）；

没有特殊说明的情况，默认总线是半双工的（通信的过程可以分为：单工（只能单向通信，有点像广播），双工（双方可以同时接收消息发送消息），半双工（某一时刻只能一方发送一方接收，对讲机））

  

总线是一组能为多个部件分时共享（半双工可以一个发送方，多个接收方）的信息传送线

  

双工要求两条物理线路；

半双工要求一条物理线路，两条逻辑线路

  

总线复用：一条线路有多个作用（给多个部件发送信息）

  

从功能上将总线分为：数据总线、地址总线、控制总线

对于即将要执行的一段程序来说，首先是根据**控制总线**里的时序来决定顺序，会由**地址总线**先把程序的首地址传到PC寄存器里，然后由**数据总线**传输对应指令的二进制数据到IR寄存器（指令寄存器，当前执行的指令），再由指令译码器

  

在cpu中叫片类总线，在计算机当中，连接cpu和内存之间的叫系统总线，在主机以外的叫外部总线，

网络里也有总线的概念，从功能上来说，会把网络上的叫做通信总线。

  

从数据传输的角度，总线可以分为并行总线和串行总线。

一般认为，串行适合长距离，并行适合短距离（成本考虑）

  

串行总线的数据发送和接收

  

数据传输有多种传输方式，可以有中断，程序查询，DMA，通道，io等机制，也可以以硬件的方式来处理

  

程序控制（查询）：分为无条件传送和程序查询方式，是通过CPU控制I/O与内存之间的数据传输。 cpu需要确认io的状态才能进行通信，即轮询（Polling）。

CPU通过执行一段程序来主动查询I/O设备的状态，判断它是否准备好进行数据传输，流程如下：

CPU执行程序，不断向I/O设备发送“状态查询”指令 - 查询完，cpu检查设备是否就绪（缓冲区是否为空，是否完成输入等） - 如果设备未就绪，CPU继续循环查询（忙等待状态）

设备就绪后，CPU立即进行数据读写操作

  

程序中断：用栈保存现场，核心态处理完之后I/O之后，出栈恢复现场

流程：CPU发起I/O操作（读取磁盘等），然后CPU继续执行主程序，当I/O设备准备好时（数据读取完成时），发出中断请求（IRQ），然后CPU收到中断，停止当前任务，执行中断服务程序（ISR），ISR完成中断任务，CPU恢复原程序继续运行。

  

DMA：Direct Memory Access，直接存储器访问

需要外接DMAC设备（DMA控制器）

CPU发出指令，告诉DMA控制器，从哪个外设读取设备、数据传到内存的什么地址、一共需要传输多少字节；

然后DMA控制器接管总线控制权（短暂替代CPU），开始执行数据传输；

外设->内存 or 内存 -> 外设，数据直接通过DMA控制器完成，不通过CPU；

传输完成后，DMA控制器给CPU发一个中断信号，通知数据传输任务已完成；

CPU会在中断里做：检查DMA状态（错误，校验，地址越界等），释放资源，唤醒等待此资源的进程（移到就绪队列），更新状态标志，可能触发下一次DMA传输

  

---

  

存储考的多，考层次化存储的特点，偶尔会考局部性原理的概念考察

  

寄存器：在cpu边上，分为通用寄存器，功能寄存器

ALU 算数逻辑运算

PC 下一条指令地址

  

汇编操作，是可以操作寄存器的，MOV AL, AH 从AH内容复制到AL

cache对程序员是不可见的

  

cache 缓存：是寄存器和内存的折中，完全来自于内存。因为cpu太快，内存太慢，做一个折中。内存中的页号，可以从某种机制决定其在cache中的位置，内存到cache的地址映射关系，由硬件直接决定。（与内容相关的cache，叫相联存储器）

  

离CPU越近，速度越快，成本越高，反之，越远越慢，越便宜

  

内存包括：DRAM-SRAM-ROM

DRAM（内存）

ROM 掉电数据不丢失，操作系统放ROM里

  

支墩存储器：ROM

一次可编程只读存储器：PROM

可擦除可编程只读存储器：EPROM

电子可擦除可编程只读存储器：EEPROM

  

### 局部性原理

  

时间局部性：有些数据是重复性使用的，比如循环

  

空间局部性：调用数据的时候，访问了一部分的数据，那很有可能接下来就会访问附近的数据，典型情况就是顺序执行

  

---

# 操作系统

  

一般考：操作系统的作用，和软件层级

![[Pasted image 20260106110234.png]]

一般认为：中断程序、硬件处理程序在 计算机硬件和操作系统之间

操作系统之上还有其他系统软件：编程语言处理系统、数据库管理系统

  

## 操作系统分类

分时操作系统：时间片轮转方式，为多个用户提供服务

实时操作系统：在规定时间内响应并处理

网络操作系统：共享网络资源

分布式操作系统：任意两台计算机可以通过通信交换信息

嵌入式操作系统：运行在智能芯片环境中（特点：微型化，可定制，实时性，可靠性，HAL（硬件抽象层），BSP（板级支撑包））

  

多道程序设计技术=》批处理技术

  

## 进程管理

进程是拥有资源的基本单位

独立调度、分配资源的

  

进程组成：PCB（进程控制块，进程的属性内容，包括优先级，状态，所需的资源数据的位置）、程序、数据

  

线程可以作为调度和分配的基本单位

![[Pasted image 20260106111910.png]]

  

进程的状态切换模型有很多种，考试一般就考三态的

![[Pasted image 20260106112121.png]]

三态模型一般默认是时间片轮转模式。时间片到了，切换到就绪状态

  

任务也分：抢占（可剥夺），非抢占式

还分不同优先级，如何确定优先级：时间片、先来先服务，短作业有限，高响应比优先（等待时间/执行时间 大的先执行）

  

等待态必须经过就绪态才能执行

  

---

  

### 进程的同步与互斥

  

临界资源：各个进程间需要互斥方式对其进行共享的资源 （打印机，缓冲区 etc）

  

互斥：同一时间只能让一个进程使用

资源类的制约关系是间接制约关系

  

同步：速度有差异，

直接制约关系

  

PV信号量；

P、V都是荷兰语；

Passeren，Verhoog；

PV都是原语（原子性）

![[Pasted image 20260107091131.png]]

  

信号量 表示资源的数量

信号量为负数的时候，表示排队进程数

  

最大值：资源数量

最小值：最大排队进程数量

  

---

  

### 前驱图/前趋图

![[Pasted image 20260107092736.png]]

考法：

节点/结点

箭线/有向边/有向弧

  

一个箭头表示一个前驱关系

入箭头是P，出箭头是V

  

执行前，P操作 检查前驱；

执行后，V操作，通知后继

  

---

  

### 死锁

  

四大条件（缺一不可）：互斥-保持和等待-不剥夺-环路等待

![[Pasted image 20260107095406.png]]

互斥是很难破坏的，一般是从其他三个点破除死锁

  

单个进程都不够 - 必定死锁

单个进程够 - 可能正常，可能死锁

  

平均分配之后 - 每个进程缺一个资源

这个情况再+1，则不可能死锁

 ---

### 银行家算法

分配资源的原则

- 当一个进程对资源的最大需求量不超过系统中的资源总数时，可以接纳

- 进程可以分期请求资源，但是请求的总数不能超过最大需求量

- 当系统现有资源不能满足进程所需资源的时候，对进程的请求可以推迟分配，但总能使进程在有限时间内得到资源

  

---

## 存储管理

### 页式存储

将程序与内存划分为同样大小的块，以页为单位将程序调入内存

  

优点：利用率高、碎片小、分配和管理简单

缺点：增加了系统开销，可能产生抖动现象（可能分配4个页面比分配3个页面中断次数更多，分配四个页面命中可能性应该更高才对，）

  

逻辑地址：页号 + 页内地址

物理地址：页帧号 + 页内地址

  

比如：

![[Pasted image 20260107101257.png]]

对应页大小为4KB的存储系统来说，

逻辑地址为：10 110011011110

则对应的物理地址为：

110 110011011110

  

逻辑地址低位（从左到右 从低到高）为10（二进制），对应2，查页表可得对应块号为6

则物理地址为：110（二进制）

  

内存页淘汰原则：

在内存

访问位为1不淘汰，优先淘汰访问位为0的

再淘汰修改位为0的

  

基址极限对

### 段式存储

按照用户作业中的自然段来划分逻辑空间，然后调入内存，段的长度可以不一样

![[Pasted image 20260107102537.png]]

逻辑段有长有短，不是固定的，每个段的大小跟程序的逻辑有关系

  

优点：多道程序共享内存，各自修改互不影响

缺点：内存利用率低，内存碎片浪费大

  

### 段页式存储

先分段再分页

  

PCB进程控制块

JCB作业控制块

  

---

## 磁盘管理

  

经典磁盘结构，由若干个盘面组成，每个盘面分为若干磁道和扇区

  

柱面号 = 磁道号；

一般来说，最外缘的磁道号是0，最内存的是n；

柱面：所有同一磁道号的磁道共同组成了一个柱面，所以柱面号跟磁道号是等价的

  

存储容量 = n * t * s * b；

n 是盘面的数量；

t 是单个盘面磁道的数量；

s 是单个磁道扇区的数量；

b 是单个扇区存储的容量大小；

  

存取时间 = 寻道时间 + 等待时间 + 传输时间；

寻道时间：磁头移动到磁道所需的时间；

等待时间：等待读写的扇区转到磁头下面所需的时间；

传输时间：磁头就位，位于所需扇区的起始位置，到，转出所需扇区的结束位置，所需的旋转时间

  

---

  

### （寻道）移臂调度算法

  

先来先服务 FCFS - 按请求顺序依次处理

  

最短寻道时间优先 SSTF - 找队列中离当前磁道最近的磁道作为下一个

  

（电梯）扫描算法 SCAN - 先按一个方向，从内到外处理，再从内到外处理

  

循环扫描算法 CSCAN - 单向电梯，只按一个方向，比如从内到外，到最外之后直接回到最内，再从内到外扫描

  

对于考题，考察先后顺序的情况，优先看柱面号，极端情况，看扇区号（磁头号不考虑）

  

---

  

## 文件系统

  

### 位示图

比如1600 bit长的位示图，如果是16位的机器，那就是100个字长，

注意好单位，有可能单位是字节，那就是200个字节

  

字长决定了位示图的一个字的长度

  

### 文件索引结构

  

unix里，文件索引是13个节点；

考试中，如题目中不提供，则默认是13个索引节点

  

直接索引有十个：

0-9号节点，存的是逻辑页的内容

  

还有一个一级间接索引：

还有一个二级间接索引：

还有一个三级间接索引：

  

每个索引的值指向一个物理块

10号指向的也是一个物理块，但是这个物理块包含的内容是个索引；

假如每个块大小是1KB，假设一个地址是4B，则可以放256个地址

  
![[Pasted image 20260108145056.png]]

